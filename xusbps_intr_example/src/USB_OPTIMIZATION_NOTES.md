# USB CDC-ACM 高速优化说明

## 硬件平台
- **ZYNQ7010 开发板**
- **USB PHY**: USB3320C-EZK
- **晶振**: 24MHz
- **电源**: 1.8V
- **支持模式**: USB 2.0 Host/Device

## 优化内容

### 1. 端点大小优化
**优化前（全速模式）：**
```c
#define CDC_DATA_EPSIZE 64      // 64字节端点
DeviceConfig.EpCfg[1].Out.MaxPacketSize = 64;
DeviceConfig.EpCfg[1].In.MaxPacketSize = 64;
```

**优化后（高速模式）：**
```c
#define CDC_DATA_EPSIZE 512     // 512字节端点
DeviceConfig.EpCfg[1].Out.MaxPacketSize = 512;
DeviceConfig.EpCfg[1].In.MaxPacketSize = 512;
```

### 2. 性能提升
| 参数 | 优化前 | 优化后 | 提升倍数 |
|------|--------|--------|----------|
| 端点大小 | 64字节 | 512字节 | 8x |
| 理论带宽 | ~12 Mbps | ~480 Mbps | 40x |
| 数据包效率 | 较低 | 高 | - |

### 3. USB3320C-EZK 特性利用
- ✅ 充分利用ULPI接口高速能力
- ✅ 优化数据包传输效率
- ✅ 减少协议开销
- ✅ 提高虚拟串口性能

### 4. 兼容性说明
- **向下兼容**: 如果主机只支持全速，设备会自动协商到全速模式
- **硬件要求**: USB3320C-EZK完全支持此配置
- **驱动兼容**: 标准CDC-ACM驱动无需修改

### 5. 测试建议
1. **连接测试**: 验证设备枚举正常
2. **速度测试**: 使用串口调试工具测试传输速度
3. **稳定性测试**: 长时间数据传输测试
4. **兼容性测试**: 不同操作系统和USB控制器测试

### 6. 预期效果
- **枚举速度**: 更快的设备识别
- **数据传输**: 显著提升的吞吐量
- **延迟**: 减少的传输延迟
- **CPU负载**: 更高效的DMA传输

## 技术细节

### USB 2.0 规范对比
| 模式 | 速度 | Bulk端点最大包 | 适用场景 |
|------|------|----------------|----------|
| 低速 | 1.5 Mbps | 8字节 | 鼠标、键盘 |
| 全速 | 12 Mbps | 64字节 | 基本CDC设备 |
| 高速 | 480 Mbps | 512字节 | **本优化目标** |

### ZYNQ7010 + USB3320C-EZK 配置
```
ZYNQ PS BANK501 ←→ USB3320C-EZK ←→ USB Host
     1.8V LVCMOS      ULPI Interface    USB 2.0
```

## 注意事项
1. 确保ZYNQ USB控制器时钟配置正确
2. 验证DMA内存对齐（32字节边界）
3. 监控功耗是否在预期范围内
4. 测试不同USB Hub的兼容性

## 相关文件
- `main.c`: 端点配置优化
- `usb_descriptors.c`: 描述符和端点大小定义
- `usb_descriptors.h`: 端点大小宏定义
